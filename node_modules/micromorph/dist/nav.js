var R=(e,t,r)=>{e.setAttribute(t,new URL(e.getAttribute(t),r).pathname)};function C(e,t){e.querySelectorAll('[href^="./"], [href^="../"]').forEach(r=>R(r,"href",t)),e.querySelectorAll('[src^="./"], [src^="../"]').forEach(r=>R(r,"src",t))}var h=e=>(t,r)=>t[`node${e}`]===r[`node${e}`],D=h("Name"),w=h("Type"),M=h("Value");function x(e,t){if(e.attributes.length===0&&t.attributes.length===0)return[];let r=[],n=new Map,i=new Map;for(let o of e.attributes)n.set(o.name,o.value);for(let o of t.attributes){let s=n.get(o.name);o.value===s?n.delete(o.name):(typeof s<"u"&&n.delete(o.name),i.set(o.name,o.value))}for(let o of n.keys())r.push({type:5,name:o});for(let[o,s]of i.entries())r.push({type:4,name:o,value:s});return r}function N(e,t=!0){let r=`${e.localName}`;for(let{name:n,value:i}of e.attributes)t&&n.startsWith("data-")||(r+=`[${n}=${i}]`);return r+=e.innerHTML,r}function T(e){switch(e.tagName){case"BASE":case"TITLE":return e.localName;case"META":{if(e.hasAttribute("name"))return`meta[name="${e.getAttribute("name")}"]`;if(e.hasAttribute("property"))return`meta[name="${e.getAttribute("property")}"]`;break}case"LINK":{if(e.hasAttribute("rel")&&e.hasAttribute("href"))return`link[rel="${e.getAttribute("rel")}"][href="${e.getAttribute("href")}"]`;if(e.hasAttribute("href"))return`link[href="${e.getAttribute("href")}"]`;break}}return N(e)}function $(e){let[t,r=""]=e.split("?"),n=new URLSearchParams(r);return n.set("t",`${Date.now()}`),`${t}?${n}`}function l(e){if(e.nodeType===1&&e.hasAttribute("data-persist"))return e;if(e.nodeType===1&&e.localName==="script"){let t=document.createElement("script");for(let{name:r,value:n}of e.attributes)r==="src"&&(n=$(n)),t.setAttribute(r,n);return t.innerHTML=e.innerHTML,t}return e.cloneNode(!0)}function V(e,t){if(e.children.length===0&&t.children.length===0)return[];let r=[],n=new Map,i=new Map,o=new Map;for(let s of e.children)n.set(T(s),s);for(let s of t.children){let a=T(s),c=n.get(a);c?N(s,!1)!==N(c,!1)&&i.set(a,l(s)):o.set(a,l(s)),n.delete(a)}for(let s of e.childNodes){if(s.nodeType===1){let a=T(s);if(n.has(a)){r.push({type:1});continue}else if(i.has(a)){let c=i.get(a);r.push({type:3,attributes:x(s,c),children:I(s,c)});continue}}r.push(void 0)}for(let s of o.values())r.push({type:0,node:l(s)});return r}function I(e,t){let r=[],n=Math.max(e.childNodes.length,t.childNodes.length);for(let i=0;i<n;i++){let o=e.childNodes.item(i),s=t.childNodes.item(i);r[i]=p(o,s)}return r}function p(e,t){if(!e)return{type:0,node:l(t)};if(!t)return{type:1};if(w(e,t)){if(e.nodeType===3){let r=e.nodeValue,n=t.nodeValue;if(r.trim().length===0&&n.trim().length===0)return}if(e.nodeType===1){if(D(e,t)){let r=e.tagName==="HEAD"?V:I;return{type:3,attributes:x(e,t),children:r(e,t)}}return{type:2,node:l(t)}}else return e.nodeType===9?p(e.documentElement,t.documentElement):M(e,t)?void 0:{type:2,value:t.nodeValue}}return{type:2,node:l(t)}}function k(e,t){if(t.length!==0)for(let{type:r,name:n,value:i}of t)r===5?e.removeAttribute(n):r===4&&e.setAttribute(n,i)}async function _(e,t,r){if(!t)return;let n;switch(e.nodeType===9?(e=e.documentElement,n=e):r?n=r:n=e,t.type){case 0:{let{node:i}=t;e.appendChild(i);return}case 1:{if(!n)return;e.removeChild(n);return}case 2:{if(!n)return;let{node:i,value:o}=t;if(typeof o=="string"){n.nodeValue=o;return}n.replaceWith(i);return}case 3:{if(!n)return;let{attributes:i,children:o}=t;k(n,i);let s=Array.from(n.childNodes);await Promise.all(o.map((a,c)=>_(n,a,s[c])));return}}}function g(e,t){let r=p(e,t);return _(e,r)}var L=()=>{},b;function Y(e={}){typeof window<"u"&&"navigation"in window&&navigation.addEventListener("navigate",t=>{if(!t.canTransition||t.hashChange||t.downloadRequest!==null)return;let r=new URL(location.toString()),n=new URL(t.destination.url);if(r.toString()===n.toString()){(e.scrollToTop??!0)&&window.scrollTo({top:0});return}let{beforeDiff:i=L,afterDiff:o=L}=e;b=b||new DOMParser;async function s(){let a=await fetch(n.toString()).then(P=>P.text()),c=b.parseFromString(a,"text/html");C(c,n),i(c);let v=c.querySelector("title");v&&(document.title=v.text),await g(document,c),(e.scrollToTop??!0)&&window.scrollTo({top:0}),o()}t.transitionWhile(s())})}export{Y as default};
